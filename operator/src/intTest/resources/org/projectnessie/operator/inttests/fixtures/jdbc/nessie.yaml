apiVersion: nessie.projectnessie.org/v1alpha1
kind: Nessie
metadata:
  name: nessie-test
spec:
  versionStore:
    type: Jdbc
    cache:
      enabled: true
      heapFraction: 600m
      minSize: 65Mi
      minFreeHeap: 66Mi
    jdbc:
      url: jdbc:postgresql://postgresql.postgresql.svc.cluster.local:5432/nessie
      username: nessie
      password:
        secret: nessie-db-credentials
        key: password
  extraEnv:
    - name: NESSIE_SERVER_DEFAULT_BRANCH
      value: my-branch
  service:
    type: NodePort
    nodePort: 30120
    sessionAffinity: ClientIP
    labels:
      foo: bar
    annotations:
      foo: bar
  monitoring:
    enabled: false
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 2
    targetCpuUtilizationPercentage: 99
  deployment:
    image:
      repository: projectnessie/nessie-test-server
      tag: @projectVersion@
      pullPolicy: Never
    labels:
      foo: bar
    annotations:
      foo: bar
    resources:
      requests:
        cpu: 800m
        memory: 384Mi
        ephemeral-storage: 10Mi
      limits:
        cpu: 800m
        memory: 384Mi
        ephemeral-storage: 10Mi
    serviceAccount:
      create: true
      name: nessie-test-custom-service-account
      annotations:
        foo: bar
    livenessProbe:
      initialDelaySeconds: 5
      periodSeconds: 3
      timeoutSeconds: 10
      successThreshold: 1
      failureThreshold: 20
    readinessProbe:
      initialDelaySeconds: 5
      periodSeconds: 3
      timeoutSeconds: 10
      successThreshold: 1
      failureThreshold: 20
